 generarPDFBtn.addEventListener('click', () => {
        const {
            jsPDF
        } = window.jspdf;
        const doc = new jsPDF('p', 'pt', 'letter');
        
        // --- Primera página: Gráfica con título ---
        const chartCanvas = document.getElementById('grafica');
        const chartImgData = chartCanvas.toDataURL('image/png', 1.0);
        const chartImgProps = doc.getImageProperties(chartImgData);
        
        const pdfWidth = doc.internal.pageSize.getWidth();
        const pdfHeight = doc.internal.pageSize.getHeight(); // Obtener la altura total de la página

        // Calcular el ancho de la imagen para que ocupe un 90% del ancho del PDF
        const imgDisplayWidth = pdfWidth * 0.9;
        // Calcular la altura de la imagen manteniendo la proporción
        const imgDisplayHeight = (chartImgProps.height * imgDisplayWidth) / chartImgProps.width;

        // Calcular las coordenadas para centrar la imagen
        const xOffsetChart = (pdfWidth - imgDisplayWidth) / 2;
        // Dejar espacio para el título, por eso se ajusta la Y
        const yOffsetChart = (pdfHeight - imgDisplayHeight) / 2 + 20; // +20 para bajar un poco la gráfica y dar espacio al título

        // Añadir el título "Reporte SCC" centrado
        const titleText = "Reporte SCC";
        doc.setFontSize(24);
        doc.text(titleText, pdfWidth / 2, 80, { align: 'center' }); // 80pt desde arriba para el título

        // Añadir la gráfica centrada
        doc.addImage(chartImgData, 'PNG', xOffsetChart, yOffsetChart, imgDisplayWidth, imgDisplayHeight);

        // --- Segunda página: Contenido HTML ---
        doc.addPage();
        
        const chartContainer = document.getElementById('grafica').closest('.chart-container');
        chartContainer.style.display = 'none'; // Oculta la gráfica para no capturarla de nuevo

        const content = document.querySelector('.container');
        html2canvas(content, { scale: 2 }).then(canvas => {
            const imgDataContent = canvas.toDataURL('image/png');
            const imgPropsContent = doc.getImageProperties(imgDataContent);
            
            // Calcular el ancho de la imagen para que ocupe un 90% del ancho del PDF
            const contentDisplayWidth = pdfWidth * 0.9;
            // Calcular la altura de la imagen manteniendo la proporción
            const contentDisplayHeight = (imgPropsContent.height * contentDisplayWidth) / imgPropsContent.width;

            // Calcular las coordenadas para centrar la imagen
            const xOffsetContent = (pdfWidth - contentDisplayWidth) / 2;
            const yOffsetContent = (pdfHeight - contentDisplayHeight) / 2;

            doc.addImage(imgDataContent, 'PNG', xOffsetContent, yOffsetContent, contentDisplayWidth, contentDisplayHeight);

            chartContainer.style.display = 'block'; // Vuelve a mostrar la gráfica en la página web

            doc.save(`reporte_scc_${new Date().toISOString().slice(0, 10)}.pdf`);
        });
    });